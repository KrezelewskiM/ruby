<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>Please direct all Support Questions and Concerns to <a href="mailto:Support@PubNub.com">Support@PubNub.com</a></h1>

<h2>PubNub Gem version 4.0.0beta</h2>

<h5>YOU MUST HAVE A PUBNUB ACCOUNT TO USE THE API.</h5>

<h5><a href="http://www.pubnub.com/account">http://www.pubnub.com/account</a></h5>

<p><a href="http://www.pubnub.com">www.pubnub.com</a> - PubNub Real-time Push Service in the Cloud.</p>

<p>The PubNub Network is a blazingly fast Global Messaging Service for building real-time web and mobile apps. Thousands of apps and developers rely on PubNub for delivering human-perceptive real-time experiences that scale to millions of users worldwide. PubNub delivers the infrastructure needed to build amazing Mobile, MMO games, social apps, business collaborative solutions, and more.</p>

<h3>Upgrading from PubNub 3.6.x / 3.7.x</h3>

<p>Main change is that we&#39;re no longer using EventMachine. Right now Celluloid is used.</p>

<h3>Upgrading from PubNub 3.5.x</h3>

<p>We&#39;ve made the response format compatible across all operations. This may break existing parsing of whereNow, leave, state, and PAM responses. So if you are monitoring these operation responses, please be sure to modify your code accordingly.</p>

<p>Examples of affected operations can be found <a href="3.5_to_3.6_upgrade_notes.md">here</a>.</p>

<h3>Upgrading from PubNub 3.3.x and Earlier</h3>

<p>PubNub 3.7.3 is NOT compatible with earlier than 3.4 versions of Pubnub Ruby Client.</p>

<h3>Upgrading from PubNub 3.4 and higher versions</h3>

<p>PubNub 3.7.3 is compatible with 3.4 version.</p>

<h2>Important Notice about Blocking vs Non-Blocking Calls</h2>

<h4>Asynchronous vs Synchronous Requests</h4>

<p>Every operation is by default asynchronous. Asynchronous operations will not block your main thread and will be fired within a new thread.</p>

<p>This can cause issues under certain situations, depending on your implementation. To work around this, you can force an operation to run synchronously (block) via the :http_sync option:</p>

<pre class="code ruby"><code class="ruby">:http_sync =&gt; true
</code></pre>

<p>Unless otherwise specified, this option is default implied false (all calls by default will be async).</p>

<h4>Message Handling: callback, block, return</h4>

<p>Results are provided via block, callback, and return, depending on how you structure the call. Callback will be fired for every message that will event get in response. Synchronous events will return array of envelopes (if you passed callback to sychronous event it will be called too!).</p>

<h3>Code Examples</h3>

<h4>Require</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pubnub</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<h4>Init and instantiate a new PubNub instance</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># If you wish to override the default logger, create one and pass it in.
</span><span class='comment'># Default logger writes into pubnub.log file
</span>
<span class='id identifier rubyid_my_logger'>my_logger</span> <span class='op'>=</span> <span class='const'>Logger</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='const'>STDOUT</span><span class='rparen'>)</span>

<span class='id identifier rubyid_pubnub'>pubnub</span> <span class='op'>=</span> <span class='const'>Pubnub</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='symbol'>:subscribe_key</span>    <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>demo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:publish_key</span>      <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>demo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:error_callback</span>   <span class='op'>=&gt;</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Error callback says: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:connect_callback</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CONNECTED: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:logger</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_my_logger'>my_logger</span>
<span class='rparen'>)</span>
</code></pre>

<ul>
<li>subscribe_key is your subscribe key</li>
<li>publish_key is your publish key</li>
<li>origin is your custom, PubNub origin (Contact support before production to get your own!)</li>
<li>error_callback is the callback for errors</li>
<li>connect_callback is the callback that lets you know when you&#39;re connected to the origin</li>
</ul>

<h4>Making PubNub calls</h4>

<p>There are a few different ways to make any given PubNub call. How to do it depends first on whether or not you want the call to be blocking (synchronous), or not blocking (asynchronous).</p>

<h5>Asynchronous (non-blocking) calling</h5>

<p>If you wish to make asyncronous calls (implemented via EventMachine), you have a few different patterns you can follow:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Lets use a callback for the first example...
</span><span class='id identifier rubyid_cb'>cb</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span> <span class='rbrace'>}</span>

<span class='comment'># Asynchronous is implicitly enabled by default, if you do not provide an :http_sync option
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span> <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cb'>cb</span><span class='rparen'>)</span>

<span class='comment'># You can also explicitly request async with :http_sync =&gt; false
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span> <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cb'>cb</span><span class='comma'>,</span> <span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>

<span class='comment'># Alternatively, you can pass in the callback as a block
</span>
<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_cb'>cb</span><span class='rparen'>)</span>

<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_status_code'>status_code</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_timetoken'>timetoken</span>
<span class='kw'>end</span>
</code></pre>

<h5>Synchronous (blocking) calling</h5>

<p>If you&#39;d prefer to make your calls blocking, set :http_sync =&gt; true. Again, there is a bit of flexibility in how this can be done:</p>

<pre class="code ruby"><code class="ruby">
<span class='comment'># Lets use a callback for the first example...
</span><span class='id identifier rubyid_cb'>cb</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span> <span class='rbrace'>}</span>

<span class='comment'># Sync (blocking) with a callback (if you wanted to)
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_cb'>cb</span><span class='rparen'>)</span>

<span class='comment'># Sync (blocking), with assignment via return
</span><span class='id identifier rubyid_myResponse'>myResponse</span> <span class='op'>=</span> <span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>myR: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_myResponse'>myResponse</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

<span class='comment'># Sync (blocking), with a block
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span><span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:message</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_status_code'>status_code</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_timetoken'>timetoken</span>
<span class='kw'>end</span>
</code></pre>

<h4>Callback / Block calling sequence</h4>

<p>When you receive messages asynchronously from PubNub, your block or callback will be called once for each message received.  For example, if you are subscribed to a channel using the callback pattern, and you receive 3 messages from your call, the callback will be called 3 times, 1 time for each unique received message.</p>

<p>Conceptually, the callback or block is fired once for each message in the raw server response:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_envelopes'>envelopes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
    <span class='id identifier rubyid_callback'>callback</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_envelope'>envelope</span>
<span class='kw'>end</span>
</code></pre>

<h4>The Envelope Object</h4>

<p>The callback (or block) will receive the message(s) in the form of an envelope hash. An envelope will contain the following keys:</p>

<ul>
<li>message (aliased as &#39;msg&#39;) -&gt; Holds message, if publish, holds published message</li>
<li>response_message -&gt; as above, except for publish - holds server response (String &quot;Send&quot;)</li>
<li>channel -&gt; Holds channel for current message</li>
<li>timetoken -&gt; Timetoken of server response</li>
<li>status (aliased as &#39;status_code&#39;) -&gt; Server response status code</li>
<li>response -&gt; Whole and unmodified server response</li>
<li>first -&gt; true if it&#39;s first envelope in single response messages array</li>
<li>last -&gt; true if it&#39;s last envelope in single response messages array</li>
<li>And a bit more, specific to some events, you will find it in description of certain events</li>
</ul>

<p>Don&#39;t confuse the <strong>message</strong> with the <strong>response</strong>. In a given callback cycle, the <strong>response</strong> will always be the same, as its the raw server response. It may consist of one or more messages.</p>

<p>Internally, the block or callback iterates over the response array, similar to:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_envelopes'>envelopes</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
    <span class='id identifier rubyid_callback'>callback</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span>
</code></pre>

<p>In a given callback cycle, the <strong>envelope</strong> will be the current element of the response array.</p>

<h3>Simple Usage Examples</h3>

<h4>Init and instantiate a new PubNub instance</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span> <span class='op'>=</span> <span class='const'>Pubnub</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
    <span class='symbol'>:subscribe_key</span>    <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>demo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:publish_key</span>      <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>demo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:origin</span>           <span class='op'>=&gt;</span> <span class='id identifier rubyid_origin'>origin</span><span class='comma'>,</span>
    <span class='symbol'>:uuid</span>              <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>myUserID</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:error_callback</span>   <span class='op'>=&gt;</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SOMETHING TERRIBLE HAPPENED HERE: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:connect_callback</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_msg'>msg</span><span class='op'>|</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>CONNECTED: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_msg'>msg</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='rbrace'>}</span>
<span class='rparen'>)</span>
</code></pre>

<h4>Publish</h4>

<p>When publishing, send a string, number, array, or hash. PubNub automatically serializes it to JSON for you, so you don&#39;t have to.</p>

<pre class="code ruby"><code class="ruby"><span class='ivar'>@my_callback</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span><span class='lparen'>(</span><span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_msg'>msg</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span>
    <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hello_world</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:message</span>  <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>hi</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<h4>Subscribe</h4>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span>
    <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='symbol'>:hello_world</span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<h4>Leave</h4>

<p>Unsubscribes from given channel (<code>:channel</code>) or channel group (<code>:group</code>) and 
fires leave event. You need to be subscribed (only async counts) to channel that 
You want to leave.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span>
    <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='symbol'>:hello_world</span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>

<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_leave'>leave</span><span class='lparen'>(</span>
    <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:hello_world</span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<p>If you want to force leave channel that you&#39;re not subscribed to, you can pass :force option to event</p>

<pre class="code ruby"><code class="ruby"># Wrong
pubnub.leave(
    :channel =&gt; :not_subbed_channel,
    :callback =&gt; @my_callback
)
# We&#39;ll get error:
Pubnub::ArgumentError: You cannot leave channel that is not subscribed

# Good
p.leave(
    :channel =&gt; :force_leave,
    :force =&gt; true,
    :callback =&gt; @my_callback
)
</code></pre>

<h4>History</h4>

<p>Retrieve previously published messages (requires activation via admin.pubnub.com)
Optional start, end, and reverse option usage can be found in the tests.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_history'>history</span><span class='lparen'>(</span>
    <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span>
    <span class='symbol'>:count</span>    <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<h4>Presence</h4>

<p>In real-time see people join and leave with occupancy summaries. (requires activation via admin.pubnub.com)</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span><span class='lparen'>(</span>
    <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='symbol'>:hello_world</span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span><span class='lparen'>(</span>
    <span class='symbol'>:group</span>    <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo:</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<h4>HereNow</h4>

<p>See who is &quot;here now&quot; in a channel (:channel) or channel group (:group) at this
very moment.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_here_now'>here_now</span><span class='lparen'>(</span>
    <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel'>channel</span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_here_now'>here_now</span><span class='lparen'>(</span>
    <span class='symbol'>:group</span>    <span class='op'>=&gt;</span> <span class='id identifier rubyid_channel_group'>channel_group</span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<h4>WhereNow</h4>

<p>See where is client with specific uuid</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_p'>p</span><span class='period'>.</span><span class='id identifier rubyid_where_now'>where_now</span><span class='lparen'>(</span>
    <span class='symbol'>:uuid</span> <span class='op'>=&gt;</span> <span class='symbol'>:my_friend</span><span class='comma'>,</span>
    <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span>
<span class='rparen'>)</span>
</code></pre>

<h4>UUID</h4>

<p>UUID is set in the initializer. A unique one is created, unless you specify one explicitly. To retrieve the current UUID:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span>
</code></pre>

<p>If you wish to manually set a custom UUID, pass in a uuid key in the initializer. See &quot;Init and instantiate a new PubNub instance&quot; for an example.</p>

<h4>Time</h4>

<p>Get the current PubNub time. This is great to use as a &quot;PubNub Ping&quot;</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_time'>time</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>callback</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='ivar'>@my_callback</span><span class='rparen'>)</span>
</code></pre>

<h3>Channel Groups</h3>

<p>Channel grouping is new feature introduced in Pubnub 3.7. It allows to group
channels into channel-groups. For example you can add <code>weather</code> and <code>sport</code>
channel to <code>news</code> channel group.</p>

<p>All channel groups specific operations can be issued with
<code>#channel_registration</code> method.</p>

<h4>Getting info</h4>

<h5>Getting all channel groups</h5>

<pre class="code ruby"><code class="ruby"><span class='comment'># Response envelope will hold info as hash in payload attribute.
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_channel_registration'>channel_registration</span><span class='lparen'>(</span><span class='label'>action:</span> <span class='symbol'>:list_groups</span><span class='comma'>,</span> <span class='label'>http_sync:</span> <span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>

<h5>Getting all channels in channel group</h5>

<pre class="code ruby"><code class="ruby"><span class='comment'># Response envelope will hold info as hash in payload attribute.
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_channel_registration'>channel_registration</span><span class='lparen'>(</span><span class='label'>action:</span> <span class='symbol'>:get</span><span class='comma'>,</span> <span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>http_sync:</span> <span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>

<h4>Adding</h4>

<h5>Add channel to channel group</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_channel_registration'>channel_registration</span><span class='lparen'>(</span><span class='label'>action:</span> <span class='symbol'>:add</span><span class='comma'>,</span> <span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>new_group</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>channel:</span> <span class='symbol'>:bot</span><span class='comma'>,</span> <span class='label'>http_sync:</span> <span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>

<h5>Remove channel group</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_channel_registration'>channel_registration</span><span class='lparen'>(</span><span class='label'>action:</span> <span class='symbol'>:remove</span><span class='comma'>,</span> <span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cg</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>http_sync:</span> <span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>

<h5>Remove channel from channel group</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_channel_registration'>channel_registration</span><span class='lparen'>(</span><span class='label'>action:</span> <span class='symbol'>:remove</span><span class='comma'>,</span> <span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>cg</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>channel:</span> <span class='symbol'>:to_remove</span><span class='comma'>,</span> <span class='label'>http_sync:</span> <span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>

<h3>PAM</h3>

<p>Developers can grant/revoke/audit fine-grained permissions for their real-time apps and data at various levels.</p>

<p>Envelopes returned by PAM events have additional :service and :payload keys.</p>

<h4>PAM Usage Examples</h4>

<p>When you issue a PAM operation, you can pass the <code>presence</code> key, the &#39;channel&#39; key, or both. </p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Will grant :r and :w permissions to demo-pnpres channel
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:presence</span> <span class='op'>=&gt;</span> <span class='symbol'>:demo</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span>

<span class='comment'># Will grant :r and :w permissions to demo channel
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:demo</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span>

<span class='comment'># Will grant :r and :w permissions to demo and demo-pnpres channels
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:presence</span> <span class='op'>=&gt;</span> <span class='symbol'>:demo</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:demo</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span>

<span class='comment'># For channel groups, all above work.
</span><span class='comment'># But channel groups additionally have :manage option.
</span>
<span class='comment'># Will grant :r, :w and :m permissions to foo:foo
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:group</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo:foo</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span>

</code></pre>

<h5>Audit</h5>

<p>Audits auths for given parameters</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_audit'>audit</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:forbidden_for_jim</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_audit'>audit</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:forbidden_for_jim</span><span class='comma'>,</span> <span class='symbol'>:auth_key</span> <span class='op'>=&gt;</span> <span class='symbol'>:jim</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span>
<span class='kw'>end</span>
</code></pre>

<h5>Grant</h5>

<p>Grants auths for given parameters, you can pass :read and :write keys as parameters</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:forbidden_to_write</span><span class='comma'>,</span> <span class='symbol'>:read</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:write</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:forbidden_to_write</span><span class='comma'>,</span> <span class='symbol'>:read</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:write</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:auth_key</span> <span class='op'>=&gt;</span> <span class='symbol'>:admin</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span>
<span class='kw'>end</span>
</code></pre>

<h5>Revoke</h5>

<p>Revokes right to read and write. Same as granting r:0 w:0.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_revoke'>revoke</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:forbidden</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:forbidden</span><span class='comma'>,</span> <span class='symbol'>:auth_key</span> <span class='op'>=&gt;</span> <span class='symbol'>:godzilla</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span>
<span class='kw'>end</span>
</code></pre>

<h3>Advanced Usage Examples</h3>

<h5>Init</h5>

<pre class="code ruby"><code class="ruby"><span class='comment'># Example below shows passing more options for client
</span><span class='comment'># Pubnub.new returns Pubnub::Client instance
</span><span class='id identifier rubyid_pubnub'>pubnub</span> <span class='op'>=</span> <span class='const'>Pubnub</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
  <span class='symbol'>:error_callback</span>             <span class='op'>=&gt;</span> <span class='id identifier rubyid_custom_error_callback'>custom_error_callback</span><span class='comma'>,</span>
  <span class='symbol'>:connect_callback</span>           <span class='op'>=&gt;</span> <span class='id identifier rubyid_custom_connect_callback'>custom_connect_callback</span><span class='comma'>,</span>
  <span class='symbol'>:ssl</span>                        <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:uuid</span>                       <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>newton</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
  <span class='symbol'>:origin</span>                     <span class='op'>=&gt;</span> <span class='id identifier rubyid_custom_origin'>custom_origin</span><span class='comma'>,</span>
  <span class='symbol'>:subscribe_timeout</span>          <span class='op'>=&gt;</span> <span class='int'>500</span><span class='comma'>,</span>
  <span class='symbol'>:non_subscribe_timeout</span>      <span class='op'>=&gt;</span> <span class='int'>3</span><span class='comma'>,</span>
  <span class='symbol'>:ttl</span>                        <span class='op'>=&gt;</span> <span class='id identifier rubyid_custom_default_ttl_for_pam'>custom_default_ttl_for_pam</span><span class='comma'>,</span>
  <span class='symbol'>:secret_key</span>                 <span class='op'>=&gt;</span> <span class='int'>0</span>
<span class='rparen'>)</span>
</code></pre>

<h6>Custom logger</h6>

<p>You can pass your custom logger as :logger key while creating new Pubnub instance. Logger invocations has set progname &#39;Pubnub::Class&#39; eg. &#39;Pubnub::Client&#39;, &#39;Pubnub::Subscribe&#39;.</p>

<h5>Publish</h5>

<pre class="code ruby"><code class="ruby"><span class='comment'># Message could be any object that have .to_json method
</span><span class='comment'># You do not need to jsonify message before sending!
</span>
<span class='comment'># This time publish event will block main thread until callback will finish as we set :http_sync to true
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_publish'>publish</span><span class='lparen'>(</span>
  <span class='symbol'>:messsage</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_message'>message</span><span class='comma'>,</span>
  <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='symbol'>:whatever</span><span class='comma'>,</span>
  <span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span> <span class='rparen'>)</span>
</code></pre>

<h5>Subscribe</h5>

<pre class="code ruby"><code class="ruby"><span class='comment'># You can pass in :channel or :channels String, Symbol, Array of both, or csv separated with commas, remember, as space is valid channel part, there should not be any spaces between commas (unless you want them)
</span><span class='comment'># Some example of valid channels:
</span><span class='comment'># :example_symbol
</span><span class='comment'># &#39;example_string&#39;
</span><span class='comment'># [:one, :two, &#39;three&#39;]
</span><span class='comment'># [:anything]
</span><span class='comment'># &#39;one,two,three&#39;
</span>
<span class='comment'># Firing sync subscribe could lock your thread even for 5 minutes
</span><span class='comment'># When there&#39;s no traffic on channel server will send timetoken without
</span><span class='comment'># any messages every ~300s.
</span><span class='comment'># First sync subscribe will just update your timetoken, you will not get any messages
</span><span class='comment'># example:
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>alerts</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'># just update timetoken
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>alerts</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span> <span class='comment'># Will fire request with current timetoken and can possibly get messages
</span>
<span class='comment'># Async subscribe will update your timetoken and will fire given callback for every message that it gets
</span><span class='comment'># example:
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>fight_log</span><span class='tstring_end'>&#39;</span></span>
<span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>attacker</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>defender</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>damage</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</code></pre>

<h6>Channel groups</h6>

<p>You can subscribe to channel group same way as You&#39;re subscribing to channels.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='label'>group:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo:foo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>channel:</span> <span class='symbol'>:ping_3</span><span class='comma'>,</span> <span class='label'>callback:</span> <span class='id identifier rubyid_callback'>callback</span><span class='rparen'>)</span>
</code></pre>

<p>Response envelopes will hold channel and channel_group values. So, if You want
to subscribe to channel group and your callback need to know where are envelopes
from, You can check it using <code>envelope.channel_group</code>. Of course You can
subscribe to channel group and plain channel at once.</p>

<h5>History</h5>

<p>History returns :count messages from given channel.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_history'>history</span><span class='lparen'>(</span>
  <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='symbol'>:actions</span><span class='comma'>,</span>
  <span class='symbol'>:count</span>    <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span>
  <span class='symbol'>:start</span>    <span class='op'>=&gt;</span> <span class='int'>13942156708212448</span><span class='comma'>,</span>
  <span class='symbol'>:end</span>      <span class='op'>=&gt;</span> <span class='int'>13942156908212448</span><span class='comma'>,</span>
  <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_replay'>replay</span>
<span class='rparen'>)</span>
</code></pre>

<p>:reverse set to true will traverse the time line in reverse starting with the newest message first. Default is false.
If both start and end arguments are provided, reverse is ignored and messages are returned starting with the newest message.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_history'>history</span><span class='lparen'>(</span>
  <span class='symbol'>:channel</span>  <span class='op'>=&gt;</span> <span class='symbol'>:actions</span><span class='comma'>,</span>
  <span class='symbol'>:count</span>    <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span>
  <span class='symbol'>:reverse</span>  <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span>
  <span class='symbol'>:callback</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_replay'>replay</span>
<span class='rparen'>)</span>
</code></pre>

<p>History envelope also contains .history_start and .history_end values</p>

<h5>Paged History</h5>

<p>Paginate through your history. You can pass <code>:channel</code>, <code>:page</code>, <code>:limit</code>, <code>:callback</code>, <code>:http_sync</code>, <code>:start</code> and <code>:end</code> options, all of them works like in history event.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_paged_history'>paged_history</span><span class='lparen'>(</span>
  <span class='symbol'>:channel</span>   <span class='op'>=&gt;</span> <span class='symbol'>:actions</span><span class='comma'>,</span>
  <span class='symbol'>:limit</span>     <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span>
  <span class='symbol'>:page</span>      <span class='op'>=&gt;</span> <span class='int'>3</span><span class='comma'>,</span>
  <span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span>
<span class='rparen'>)</span>
</code></pre>

<h5>Presence</h5>

<p>Presence works exactly the same way as subscribe, it just adds &#39;-pnpres&#39; to channel name.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span><span class='lparen'>(</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:mars</span>
<span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_show_in_roster'>show_in_roster</span><span class='lparen'>(</span><span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_uuid'>uuid</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<h5>HereNow</h5>

<p>HereNow shows us who is currently subscribing channel and how much clients are online on given channel.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_here_now'>here_now</span><span class='lparen'>(</span>
  <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:pamam_moon_iv</span>
<span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_parsed_response'>parsed_response</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uuids</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_parsed_response'>parsed_response</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>occupancy</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
<span class='kw'>end</span>
</code></pre>

<p>You can also give no specific channel. Then you&#39;ll get global HereNow event response which holds all channels.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_here_now'>here_now</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_parsed_response'>parsed_response</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>channels</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='rbrace'>}</span>
</code></pre>

<h5>Heartbeat</h5>

<p>Heartbeat (expressed in seconds) is used to signal to the server that the client is still online. If the client disconnects without a leave event, others observing presence on the channel will not notice that this client has left the channel until a maximum of heartbeat interval seconds.</p>

<p>You normally will never need to touch this value, unless your Ruby client resides on a poor or mobile connection.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span> <span class='op'>=</span> <span class='const'>Pubnub</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:subscribe_key</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>demo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:heartbeat</span> <span class='op'>=&gt;</span> <span class='int'>60</span><span class='rparen'>)</span>
</code></pre>

<p>Update it via heartbeat= and set_heartbeat()</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_heartbeat'>heartbeat</span> <span class='op'>=</span> <span class='int'>120</span>
<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_set_heartbeat'>set_heartbeat</span> <span class='int'>240</span>
</code></pre>

<p>Read it via heartbeat and get_heartbeat()</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_heartbeat'>heartbeat</span>
<span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_get_heartbeat'>get_heartbeat</span>
</code></pre>

<h4>Pam</h4>

<p>PAM allows you to grant read and write access basing on channels and auth_keys.
Every pam event requires :secret_key (Remember! You should set it while initializing pubnub)</p>

<p>PAM actions could take :presence option, that will grant/revoke/audit permissions on given presence channel.
:presence option can be used along with :channel.</p>

<h5>Audit</h5>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_audit'>audit</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hidden_system</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_msg'>msg</span> <span class='rbrace'>}</span>

</code></pre>

<h5>Grant</h5>

<pre class="code ruby"><code class="ruby"><span class='comment'># Channel level
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hidden_system</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:read</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:write</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_msg'>msg</span> <span class='rbrace'>}</span>

<span class='comment'># Auth key level
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_grant'>grant</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hidden_system</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:read</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:write</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='symbol'>:auth_key</span> <span class='op'>=&gt;</span> <span class='symbol'>:lemon</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_msg'>msg</span> <span class='rbrace'>}</span>
</code></pre>

<h5>Revoke</h5>

<p>Revoke is equal to grant with w false, read false</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Channel level
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_revoke'>revoke</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hidden_system</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_msg'>msg</span> <span class='rbrace'>}</span>

<span class='comment'># Auth key level
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_revoke'>revoke</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>hidden_system</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:auth_key</span> <span class='op'>=&gt;</span> <span class='symbol'>:lemon</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_envelope'>envelope</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_envelope'>envelope</span><span class='period'>.</span><span class='id identifier rubyid_msg'>msg</span> <span class='rbrace'>}</span>
</code></pre>

<h3>State</h3>

<p>State is stored on the server for subscribed uuid, you can pass state in few ways and you can get it from server.</p>

<h4>Setting state</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># You can set state in a few ways
</span><span class='comment'># Using subscribe
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>my_channel</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:state</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:my_channel</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:key</span> <span class='op'>=&gt;</span> <span class='symbol'>:value</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='rparen'>)</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_e'>e</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_msg'>msg</span> <span class='rbrace'>}</span>
<span class='comment'># Be aware that state have to be hash of hashes where keys are subscribed channel names
</span>
<span class='comment'># Using event #set_state
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='symbol'>:state</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:key</span> <span class='op'>=&gt;</span> <span class='symbol'>:value</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:channel</span> <span class='op'>=&gt;</span> <span class='symbol'>:my_channel</span><span class='comma'>,</span> <span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>

<span class='comment'># or with channel groups
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_set_state'>set_state</span><span class='lparen'>(</span><span class='symbol'>:state</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:key</span> <span class='op'>=&gt;</span> <span class='symbol'>:value</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:group</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>foo:foo</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>

</code></pre>

<h4>Getting state</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># All you need to know is just uuid and channel
</span><span class='id identifier rubyid_pubnub'>pubnub</span><span class='period'>.</span><span class='id identifier rubyid_state'>state</span><span class='lparen'>(</span><span class='symbol'>:uuid</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>uuid_client_that_i_am_searching_for</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:http_sync</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>

<h4>State and channel groups</h4>

<p>State works fine with channel groups too! Just pass the <code>:group</code> key when
setting or do it while subscribing.</p>

<h3>Other</h3>

<p>Advanced usage examples can be found also in the examples directory.</p>

<h4>demo_console</h4>

<p>A demo console app which shows how to use just about every PubNub Ruby call, just about every possible way!</p>

<h4>translator</h4>

<p>A chat room, with real-time translation! This is using PubNub for the real-time chat, and Bing translation services for babel.</p>

<h4>pubnub_livestream</h4>

<p>Demo rails chat app. It has also been tested with Heroku.</p>

<h4>sinatra</h4>

<p>Sinatra demo.</p>

<h4>sub_and_unsub_1</h4>

<p>Mixing up some async pubs and subs, using blocks and callbacks.</p>

<h4>serial_publish</h4>

<p>Publish 10000 times with an explicit 0.05s delay between publishes</p>

<h2>Proxy support</h2>

<p>Basic proxy is supported using ENV global, before initializing pubnub just set:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_PROXY</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>      <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>http://my.poxy/</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_PROXY_USER</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user</span><span class='tstring_end'>&#39;</span></span>
<span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>HTTP_PROXY_PASS</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>secret</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<p>after that you can initialize pubnub object as always.</p>

<h1>Please direct all Support Questions and Concerns to <a href="mailto:Support@PubNub.com">Support@PubNub.com</a></h1>
</div></div>

    <div id="footer">
  Generated on Tue Aug 18 16:02:32 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.6).
</div>

  </body>
</html>